<!DOCTYPE html>
<html lang="en" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Kitab - An AI-powered note taker with chat, mind maps, and quizzes.">
    <title>Kitab — AI Note Taker</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=Amiri:ital,wght@0,400;0,700;1,400&family=Sumana:wght@400;700&family=Sometype+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
</head>

<body>
    <div class="texture-overlay"></div>
    <div class="bg-glow bg-glow-1"></div>
    <div class="bg-glow bg-glow-2"></div>
    <div class="bg-glow bg-glow-3"></div>
    <header class="header glass-panel">
        <div class="header-left">
            <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <line x1="4" y1="7" x2="20" y2="7" />
                    <line x1="4" y1="12" x2="16" y2="12" />
                    <line x1="4" y1="17" x2="12" y2="17" />
                </svg>
            </button>
            <div class="brand">
                <span class="brand-mark">کتاب</span>
                <span class="brand-text">Kitab</span>
                <span class="brand-subtitle">किताब</span>
            </div>
        </div>

        <div class="header-center">
            <div class="rate-limits" id="rate-limits-container"></div>
        </div>

        <nav class="header-right">
            <button class="icon-btn" id="btn-help" title="Help">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="10" />
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                    <circle cx="12" cy="17" r="0.5" fill="currentColor" />
                </svg>
            </button>
            <button class="icon-btn" id="btn-theme" title="Toggle theme">
                <svg class="icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="4" />
                    <path
                        d="M12 2v2M12 20v2M4.93 4.93l1.41 1.41M17.66 17.66l1.41 1.41M2 12h2M20 12h2M6.34 17.66l-1.41 1.41M19.07 4.93l-1.41 1.41" />
                </svg>
                <svg class="icon-moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                </svg>
            </button>
            <button class="btn btn-accent" id="btn-new-note">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19" />
                    <line x1="5" y1="12" x2="19" y2="12" />
                </svg>
                <span>New</span>
            </button>
        </nav>
    </header>

    <main class="main">
        <aside class="sidebar glass-panel" id="sidebar">
            <div class="sidebar-header">
                <span class="sidebar-label">Library</span>
                <span class="sidebar-count" id="notes-count">0</span>
            </div>
            <div class="sidebar-search">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="11" cy="11" r="7" />
                    <path d="M21 21l-4.35-4.35" />
                </svg>
                <input type="text" id="search-input" placeholder="Search notes">
            </div>
            <div class="notes-list" id="notes-list">
                <div class="empty-state" id="empty-state">
                    <svg class="empty-icon" viewBox="0 0 48 48" fill="none">
                        <rect x="10" y="6" width="28" height="36" rx="3" stroke="currentColor" stroke-width="1.5" />
                        <line x1="16" y1="16" x2="32" y2="16" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" />
                        <line x1="16" y1="24" x2="28" y2="24" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" />
                        <line x1="16" y1="32" x2="24" y2="32" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" />
                    </svg>
                    <p class="empty-title">No notes yet</p>
                    <p class="empty-subtitle">Create your first note to begin</p>
                </div>
            </div>
        </aside>

        <section class="editor-section" id="editor-section">
            <div class="editor-container">
                <div class="editor-header">
                    <input type="text" class="note-title-input" id="note-title" placeholder="Untitled">
                    <div class="editor-meta">
                        <span class="meta-tag" id="meta-date">Today</span>
                        <span class="meta-tag" id="meta-words">0 words</span>
                    </div>
                </div>

                <div class="editor-toolbar glass-panel">
                    <div class="toolbar-group editor-mode-toggle">
                        <button class="mode-toggle-btn active" id="btn-mode-text" title="Text Mode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M12 20h9" />
                                <path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z" />
                            </svg>
                            Text
                        </button>
                        <button class="mode-toggle-btn" id="btn-mode-draw" title="Handwriting Mode">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
                            </svg>
                            Draw
                        </button>
                    </div>
                    <div class="toolbar-sep" id="text-mode-sep"></div>
                    <div class="toolbar-group" id="text-mode-views">
                        <button class="toolbar-btn" id="btn-edit-view" title="Edit">Edit</button>
                        <button class="toolbar-btn" id="btn-preview-view" title="Read">Read</button>
                        <button class="toolbar-btn" id="btn-split-view" title="Split">Split</button>
                    </div>
                    <div class="toolbar-sep" id="text-mode-sep-2"></div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn" id="btn-bold" title="Bold"><strong>B</strong></button>
                        <button class="toolbar-btn" id="btn-italic" title="Italic"><em>I</em></button>
                        <button class="toolbar-btn" id="btn-heading" title="Heading">H</button>
                        <button class="toolbar-btn" id="btn-list" title="List">
                            <svg viewBox="0 0 16 16" fill="currentColor">
                                <circle cx="2" cy="4" r="1.5" />
                                <circle cx="2" cy="8" r="1.5" />
                                <circle cx="2" cy="12" r="1.5" />
                                <rect x="6" y="3" width="9" height="2" rx="1" />
                                <rect x="6" y="7" width="9" height="2" rx="1" />
                                <rect x="6" y="11" width="9" height="2" rx="1" />
                            </svg>
                        </button>
                        <button class="toolbar-btn" id="btn-code" title="Code">
                            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                <polyline points="10 3 14 8 10 13" />
                                <polyline points="6 13 2 8 6 3" />
                            </svg>
                        </button>
                    </div>
                    <div class="toolbar-sep"></div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn toolbar-accent" id="btn-ai-write"
                            title="Write with AI">Write</button>
                        <button class="toolbar-btn toolbar-accent" id="btn-ai-enhance" title="Enhance">Enhance</button>
                        <button class="toolbar-btn toolbar-accent" id="btn-ai-summarize"
                            title="Summarize">Summarize</button>
                        <button class="toolbar-btn toolbar-accent" id="btn-ai-expand" title="Expand">Expand</button>
                    </div>
                    <div class="toolbar-sep"></div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn toolbar-feature" id="btn-mindmap" title="Mind Map">Mind Map</button>
                        <button class="toolbar-btn toolbar-feature" id="btn-quiz" title="Quiz">Quiz</button>
                        <label class="toolbar-btn toolbar-feature" title="Upload">
                            Upload
                            <input type="file" id="file-input" accept=".pdf,.txt,.md" hidden>
                        </label>
                    </div>
                    <div class="toolbar-grow"></div>
                    <div class="toolbar-group">
                        <button class="toolbar-btn toolbar-danger" id="btn-delete" title="Delete">
                            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path
                                    d="M3 4h10M5 4V3a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1M6 7v5M10 7v5M4 4l1 10a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1l1-10" />
                            </svg>
                        </button>
                        <button class="toolbar-btn toolbar-save" id="btn-save" title="Save">Save</button>
                    </div>
                </div>

                <div class="editor-body">
                    <div class="editor-write" id="editor-write">
                        <textarea class="note-content" id="note-content" placeholder="Begin writing..."></textarea>
                    </div>
                    <div class="editor-preview hidden" id="editor-preview">
                        <div class="markdown-body" id="markdown-preview"></div>
                    </div>
                    <div class="handwriting-container" id="handwriting-container">
                        <div id="handwriting-toolbar-container"></div>
                        <div id="handwriting-canvas-container"></div>
                    </div>
                </div>
            </div>

            <div class="editor-empty-state glass-panel hidden" id="editor-empty-state">
                <div class="empty-content">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="12" y1="18" x2="12" y2="12"></line>
                        <line x1="9" y1="15" x2="15" y2="15"></line>
                    </svg>
                    <h2>Select or Create a Note</h2>
                    <p>Choose a note from the sidebar or start a new one.</p>
                    <button class="btn btn-accent" id="btn-empty-create">Create New Note</button>
                </div>
            </div>
        </section>
    </main>

    <button class="fab" id="fab-chat" title="Chat with note">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path
                d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" />
        </svg>
    </button>

    <!-- Context Menu -->
    <div class="context-menu glass-panel hidden" id="context-menu">
        <div class="context-item" id="ctx-cut">
            <span>Cut</span>
            <kbd>Ctrl+X</kbd>
        </div>
        <div class="context-item" id="ctx-copy">
            <span>Copy</span>
            <kbd>Ctrl+C</kbd>
        </div>
        <div class="context-item" id="ctx-paste">
            <span>Paste</span>
            <kbd>Ctrl+V</kbd>
        </div>
        <div class="context-sep"></div>
        <div class="context-item" id="ctx-undo">
            <span>Undo</span>
            <kbd>Ctrl+Z</kbd>
        </div>
        <div class="context-item" id="ctx-redo">
            <span>Redo</span>
            <kbd>Ctrl+Y</kbd>
        </div>
        <div class="context-sep"></div>
        <div class="context-item" id="ctx-ai-write-ctx">
            <span>Write with AI...</span>
        </div>
    </div>

    <!-- AI Write Modal -->
    <div class="modal-overlay" id="ai-write-modal">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h3>Write with AI</h3>
                <button class="icon-btn-sm" id="ai-write-close">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="12" y1="4" x2="4" y2="12" />
                        <line x1="4" y1="4" x2="12" y2="12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 0.5rem; color: var(--text-muted);">What should the note be about?</p>
                <textarea class="modal-input" id="ai-write-input" rows="4"
                    placeholder="e.g. The history of calligraphy in the Islamic Golden Age..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="ai-write-cancel">Cancel</button>
                <button class="btn btn-accent" id="ai-write-confirm">Generate</button>
            </div>
        </div>
    </div>

    <div class="chat-drawer glass-panel" id="chat-panel">
        <div class="chat-header">
            <span class="chat-title">Conversation</span>
            <div class="chat-actions">
                <button class="icon-btn-sm" id="btn-chat-clear" title="Clear">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M2 4h12M4 4V3a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v1M5 7v6M8 7v6M11 7v6" />
                    </svg>
                </button>
                <button class="icon-btn-sm" id="chat-panel-close" title="Close">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="12" y1="4" x2="4" y2="12" />
                        <line x1="4" y1="4" x2="12" y2="12" />
                    </svg>
                </button>
            </div>
        </div>
        <div class="chat-messages" id="chat-messages">
            <div class="chat-welcome">
                <svg viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="1">
                    <circle cx="16" cy="16" r="12" />
                    <path d="M16 10v4l3 3" />
                </svg>
                <p>Ask anything about your note</p>
            </div>
        </div>
        <div class="chat-typing hidden" id="chat-typing">
            <span></span><span></span><span></span>
        </div>
        <div class="chat-input-area">
            <textarea class="chat-input" id="chat-input" placeholder="Type a message..." rows="1"></textarea>
            <button class="chat-send" id="btn-chat-send">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z" />
                </svg>
            </button>
        </div>
    </div>

    <div class="ai-panel glass-panel" id="ai-panel">
        <div class="ai-panel-header">
            <span>AI Result</span>
            <button class="icon-btn-sm" id="ai-panel-close">
                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                    <line x1="12" y1="4" x2="4" y2="12" />
                    <line x1="4" y1="4" x2="12" y2="12" />
                </svg>
            </button>
        </div>
        <div class="ai-panel-content">
            <div class="ai-loading" id="ai-loading">
                <div class="loader"></div>
                <p>Processing</p>
            </div>
            <div class="ai-result hidden" id="ai-result">
                <div class="markdown-body" id="ai-result-content"></div>
            </div>
        </div>
        <div class="ai-panel-actions">
            <button class="btn btn-ghost" id="btn-discard-ai">Discard</button>
            <button class="btn btn-accent" id="btn-apply-ai">Apply</button>
        </div>
    </div>

    <div class="fullscreen-loader" id="fullscreen-loader">
        <div class="fullscreen-loader-content glass-panel">
            <div class="loader-lg"></div>
            <h2 id="loader-title">Generating</h2>
            <p id="loader-subtitle">This may take a moment</p>
        </div>
    </div>

    <div class="modal-overlay" id="mindmap-modal">
        <div class="modal-fullscreen glass-panel" id="mindmap-content">
            <div class="modal-header">
                <h2>Mind Map</h2>
                <button class="icon-btn-sm" id="mindmap-close">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="12" y1="4" x2="4" y2="12" />
                        <line x1="4" y1="4" x2="12" y2="12" />
                    </svg>
                </button>
            </div>
            <div class="mindmap-canvas" id="mindmap-canvas"></div>
        </div>
    </div>

    <div class="modal-overlay" id="quiz-modal">
        <div class="modal-fullscreen glass-panel" id="quiz-content-wrapper">
            <div class="modal-header">
                <h2>Quiz</h2>
                <button class="icon-btn-sm" id="quiz-close">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="12" y1="4" x2="4" y2="12" />
                        <line x1="4" y1="4" x2="12" y2="12" />
                    </svg>
                </button>
            </div>
            <div class="quiz-body" id="quiz-content"></div>
            <div class="quiz-nav">
                <button class="btn btn-ghost" id="quiz-prev">Previous</button>
                <button class="btn btn-accent" id="quiz-next">Next</button>
                <button class="btn btn-accent hidden" id="quiz-restart">Try Again</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal glass-panel">
            <div class="modal-header">
                <h3 id="modal-title">Confirm</h3>
                <button class="icon-btn-sm" id="modal-close">
                    <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                        <line x1="12" y1="4" x2="4" y2="12" />
                        <line x1="4" y1="4" x2="12" y2="12" />
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer">
                <button class="btn btn-ghost" id="modal-cancel">Cancel</button>
                <button class="btn btn-danger" id="modal-confirm">Delete</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="help-modal">
        <div class="modal glass-panel help-content">
            <button class="modal-close-abs" id="help-close">
                <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5">
                    <line x1="12" y1="4" x2="4" y2="12" />
                    <line x1="4" y1="4" x2="12" y2="12" />
                </svg>
            </button>
            <h2>Getting Started</h2>
            <section class="help-section">
                <h4>Features</h4>
                <ul>
                    <li><strong>Enhance</strong> &mdash; Improve writing quality</li>
                    <li><strong>Summarize</strong> &mdash; Extract key points</li>
                    <li><strong>Chat</strong> &mdash; Ask questions about your notes</li>
                    <li><strong>Mind Map</strong> &mdash; Visualize structure</li>
                    <li><strong>Quiz</strong> &mdash; Test your knowledge</li>
                    <li><strong>Upload</strong> &mdash; Import PDF or text</li>
                </ul>
            </section>
            <section class="help-section">
                <h4>Shortcuts</h4>
                <p><kbd>Ctrl</kbd> + <kbd>S</kbd> Save &nbsp;&nbsp; <kbd>Ctrl</kbd> + <kbd>B</kbd> Bold</p>
            </section>
        </div>
    </div>

    <div class="toast-container" id="toast-container"></div>

    <script type="module" src="js/app.js"></script>
</body>

</html>